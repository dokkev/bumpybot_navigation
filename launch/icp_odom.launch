<?xml version="1.0"?>

<launch>


  <!-- Arguments -->

    <arg name ="rviz" default="false"/>
    <arg name="filter" default="true"/>

    <!-- Topic Name -->
    <arg name="icp_odom_topic" default="odom_icp"/>
    <arg name="filtered_odom_topic" default="odom_icp_filtered"/>

    <!-- Frame ID (TF Name) -->
    <arg name="icp_odom_frame_id" default="odom_icp"/>
    <arg name="base_frame_id" default="base_link"/>
    <arg name="alpha_value" default="0.1"/>
    <arg name="publish_filtered_odom'" default="True"/>


  <group unless="$(arg filter)">
    <!-- ICP Node -->
    <node pkg="rtabmap_odom" type="icp_odometry" name="icp_odometry">
      <param name="odom_frame_id" value="$(arg icp_odom_frame_id)"/>
      <param name="frame_id" value="$(arg base_frame_id)"/>
      <param name="publish_tf" value="true"/>
    </node>    
  </group>


  <group if="$(arg filter)">
  <!-- Wit Filter,  the name of unfiltered odom topic is /odom_icp -->
    <!-- ICP Node -->
    <node pkg="rtabmap_odom" type="icp_odometry" name="icp_odometry">
      <param name="frame_id" value="$(arg base_frame_id)"/>
      <param name="publish_tf" value="false"/>
      <remap from="odom" to="$(arg icp_odom_topic)"/>

    </node>

    <!-- Filter Node -->
    <node name="odom_lpf" pkg="trikey_base_controller" type="odom_lpf">
      <param name="alpha" value="$(arg alpha_value)"/>
      <param name="odom_topic" value="$(arg icp_odom_topic)"/>
      <param name="raw_odom_topic" value="$(arg icp_odom_topic)"/>
      <param name="filtered_odom_topic" value="$(arg filtered_odom_topic)"/>
    </node>

     <!-- Send TF from odom_filtered to odom -->
    <!-- <node pkg="tf" type="static_transform_publisher" name="icp_odom_to_odom" args="0 0 0 0 0 0 odom_filtered odom 100" /> -->
    <!-- <node pkg="tf" type="static_transform_publisher" name="icp_odom_to_odom" args="0 0 0 0 0 0 odom base_link 100" /> -->
  </group>





  <!-- Visualization RVIZ -->
  <group if ="$(arg rviz)">
    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find bumpybot_navigation)/config/odom_testing.rviz"/>
  
    <!-- static /map->/odom transform for Rviz -->
    <node  pkg="tf" type="static_transform_publisher" name="map_odom" args="0 0 0 0 0 0 map odom 100" />
    
  </group>


</launch>